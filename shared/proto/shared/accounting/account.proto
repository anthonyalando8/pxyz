syntax = "proto3";

package accounting.v1;

import "google/protobuf/timestamp.proto";
//import "google/protobuf/empty.proto";

option go_package = "genproto/shared/accounting/v1;accountingpb";

// ===============================
// ENUMS
// ===============================

enum OwnerType {
    OWNER_TYPE_UNSPECIFIED = 0;
    OWNER_TYPE_USER = 1;
    OWNER_TYPE_PARTNER = 2;
    OWNER_TYPE_SYSTEM = 3;
    OWNER_TYPE_ADMIN = 4;
    OWNER_TYPE_AGENT = 5;
}

enum AccountType {
    ACCOUNT_TYPE_UNSPECIFIED = 0;
    ACCOUNT_TYPE_REAL = 1;
    ACCOUNT_TYPE_DEMO = 2;
}

enum AccountPurpose {
    ACCOUNT_PURPOSE_UNSPECIFIED = 0;
    ACCOUNT_PURPOSE_WALLET = 1;
    ACCOUNT_PURPOSE_LIQUIDITY = 2;
    ACCOUNT_PURPOSE_CLEARING = 3;
    ACCOUNT_PURPOSE_FEES = 4;
    ACCOUNT_PURPOSE_ESCROW = 5;
    ACCOUNT_PURPOSE_SETTLEMENT = 6;
    ACCOUNT_PURPOSE_REVENUE = 7;
    ACCOUNT_PURPOSE_CONTRA = 8;
    ACCOUNT_PURPOSE_COMMISSION = 9;
}

enum DrCr {
    DR_CR_UNSPECIFIED = 0;
    DR_CR_DEBIT = 1;
    DR_CR_CREDIT = 2;
}

enum TransactionType {
    TRANSACTION_TYPE_UNSPECIFIED = 0;
    TRANSACTION_TYPE_DEPOSIT = 1;
    TRANSACTION_TYPE_WITHDRAWAL = 2;
    TRANSACTION_TYPE_TRANSFER = 3;
    TRANSACTION_TYPE_CONVERSION = 4;
    TRANSACTION_TYPE_FEE = 5;
    TRANSACTION_TYPE_COMMISSION = 6;
    TRANSACTION_TYPE_TRADE = 7;
    TRANSACTION_TYPE_ADJUSTMENT = 8;
    TRANSACTION_TYPE_REFUND = 9;
    TRANSACTION_TYPE_REVERSAL = 10;
}

enum TransactionStatus {
    TRANSACTION_STATUS_UNSPECIFIED = 0;
    TRANSACTION_STATUS_PROCESSING = 1;
    TRANSACTION_STATUS_EXECUTING = 2;
    TRANSACTION_STATUS_COMPLETED = 3;
    TRANSACTION_STATUS_FAILED = 4;
}

enum FeeType {
    FEE_TYPE_UNSPECIFIED = 0;
    FEE_TYPE_PLATFORM = 1;
    FEE_TYPE_NETWORK = 2;
    FEE_TYPE_CONVERSION = 3;
    FEE_TYPE_WITHDRAWAL = 4;
    FEE_TYPE_AGENT_COMMISSION = 5;
}

// ===============================
// ACCOUNT MESSAGES
// ===============================

message Account {
    int64 id = 1;
    string account_number = 2;
    OwnerType owner_type = 3;
    string owner_id = 4;
    string currency = 5;
    AccountPurpose purpose = 6;
    AccountType account_type = 7;
    bool is_active = 8;
    bool is_locked = 9;
    double overdraft_limit = 10;
    int64 parent_agent_id = 11;
    string commission_rate = 12; // NUMERIC as string (e.g. "0.0025")
    google.protobuf.Timestamp created_at = 13;
    google.protobuf.Timestamp updated_at = 14;
}

message Balance {
    int64 account_id = 1;
    string account_number = 2;
    double balance = 3; // Atomic units (e.g., cents)
    double available_balance = 4;
    double pending_debit = 5;
    double pending_credit = 6;
    string currency = 7;
    int64 version = 8;
    google.protobuf.Timestamp last_transaction_at = 9;
}

message CreateAccountRequest {
    OwnerType owner_type = 1;
    string owner_id = 2;
    string currency = 3;
    AccountPurpose purpose = 4;
    AccountType account_type = 5;
    double overdraft_limit = 6;
    int64 parent_agent_id = 7;
    string commission_rate = 8;
}

message CreateAccountsRequest {
    repeated CreateAccountRequest accounts = 1;
}

message CreateAccountResponse {
    Account account = 1;
}

message CreateAccountsResponse {
    repeated Account accounts = 1;
    map<int32, string> errors = 2; // index -> error message
}

message GetAccountRequest {
    oneof identifier {
        int64 id = 1;
        string account_number = 2;
    }
}

message GetAccountResponse {
    Account account = 1;
}

message GetAccountsByOwnerRequest {
    OwnerType owner_type = 1;
    string owner_id = 2;
    AccountType account_type = 3;
}

message GetAccountsByOwnerResponse {
    repeated Account accounts = 1;
}

message GetOrCreateUserAccountsRequest {
    string user_id = 1;
    AccountType account_type = 2;
    OwnerType owner_type = 3;
}

message GetOrCreateUserAccountsResponse {
    repeated Account accounts = 1;
}

message UpdateAccountRequest {
    int64 id = 1;
    optional bool is_active = 2;
    optional bool is_locked = 3;
    optional double overdraft_limit = 4;
}

message UpdateAccountResponse {
    Account account = 1;
}

message GetBalanceRequest {
    oneof identifier {
        int64 account_id = 1;
        string account_number = 2;
    }
}

message GetBalanceResponse {
    Balance balance = 1;
}

// ===============================
// TRANSACTION MESSAGES
// ===============================

message LedgerEntry {
    string account_number = 1;
    double amount = 2; // Atomic units
    DrCr dr_cr = 3;
    string currency = 4;
    optional string description = 5;
}

message ExecuteTransactionRequest {
    optional string idempotency_key = 1;
    TransactionType transaction_type = 2;
    AccountType account_type = 3;
    repeated LedgerEntry entries = 4;
    optional string external_ref = 5;
    optional string description = 6;
    string created_by_external_id = 7;
    OwnerType created_by_type = 8;
    optional string ip_address = 9;
    optional string user_agent = 10;
    bool generate_receipt = 11;
}

message ExecuteTransactionResponse {
    string receipt_code = 1;
    int64 transaction_id = 2;
    TransactionStatus status = 3;
    double amount = 4;
    string currency = 5;
    double fee = 6;
    int64 processing_time_ms = 7;
    google.protobuf.Timestamp created_at = 8;
}

message ExecuteTransactionSyncRequest {
    // Same as ExecuteTransactionRequest
    optional string idempotency_key = 1;
    TransactionType transaction_type = 2;
    AccountType account_type = 3;
    repeated LedgerEntry entries = 4;
    optional string external_ref = 5;
    optional string description = 6;
    string created_by_external_id = 7;
    OwnerType created_by_type = 8;
    optional string ip_address = 9;
    optional string user_agent = 10;
    bool generate_receipt = 11;
}

message ExecuteTransactionSyncResponse {
    // Same as ExecuteTransactionResponse but guaranteed completed
    string receipt_code = 1;
    int64 transaction_id = 2;
    TransactionStatus status = 3;
    double amount = 4;
    string currency = 5;
    double fee = 6;
    int64 processing_time_ms = 7;
    google.protobuf.Timestamp created_at = 8;
}

message GetTransactionStatusRequest {
    string receipt_code = 1;
}

message GetTransactionStatusResponse {
    string receipt_code = 1;
    TransactionStatus status = 2;
    optional string error_message = 3;
    google.protobuf.Timestamp started_at = 4;
    optional google.protobuf.Timestamp completed_at = 5;
}

message GetTransactionByReceiptRequest {
    string receipt_code = 1;
}

message GetTransactionByReceiptResponse {
    Journal journal = 1;
    repeated Ledger ledgers = 2;
    repeated TransactionFee fees = 3;
}

// ===============================
// JOURNAL & LEDGER MESSAGES
// ===============================

message Journal {
    int64 id = 1;
    string idempotency_key = 2;
    TransactionType transaction_type = 3;
    AccountType account_type = 4;
    string external_ref = 5; // Receipt code stored here
    string description = 6;
    string created_by_external_id = 7;
    OwnerType created_by_type = 8;
    string ip_address = 9;
    string user_agent = 10;
    google.protobuf.Timestamp created_at = 11;
}

message Ledger {
    int64 id = 1;
    int64 journal_id = 2;
    int64 account_id = 3;
    string account_number = 4;
    double amount = 5;
    DrCr dr_cr = 6;
    string currency = 7;
    double balance_after = 8;
    optional string description = 9;
    optional string receipt_code = 10;
    google.protobuf.Timestamp created_at = 11;
}

message GetJournalRequest {
    int64 id = 1;
}

message GetJournalResponse {
    Journal journal = 1;
}

message ListJournalsRequest {
    optional TransactionType transaction_type = 1;
    optional AccountType account_type = 2;
    optional string external_ref = 3;
    optional string created_by_external_id = 4;
    optional google.protobuf.Timestamp from = 5;
    optional google.protobuf.Timestamp to = 6;
    int32 limit = 7;
    int32 offset = 8;
}

message ListJournalsResponse {
    repeated Journal journals = 1;
    int32 total = 2;
}

message ListLedgersByJournalRequest {
    int64 journal_id = 1;
}

message ListLedgersByJournalResponse {
    repeated Ledger ledgers = 1;
}

message ListLedgersByAccountRequest {
    string account_number = 1;
    AccountType account_type = 2;
    optional google.protobuf.Timestamp from = 3;
    optional google.protobuf.Timestamp to = 4;
    int32 limit = 5;
    int32 offset = 6;
}

message ListLedgersByAccountResponse {
    repeated Ledger ledgers = 1;
    int32 total = 2;
}

// ===============================
// STATEMENT MESSAGES
// ===============================

message AccountStatement {
    string account_number = 1;
    AccountType account_type = 2;
    repeated Ledger ledgers = 3;
    double opening_balance = 4;
    double closing_balance = 5;
    double total_debits = 6;
    double total_credits = 7;
    google.protobuf.Timestamp period_start = 8;
    google.protobuf.Timestamp period_end = 9;
}

message GetAccountStatementRequest {
    string account_number = 1;
    AccountType account_type = 2;
    google.protobuf.Timestamp from = 3;
    google.protobuf.Timestamp to = 4;
}

message GetAccountStatementResponse {
    AccountStatement statement = 1;
}

message GetOwnerStatementRequest {
    OwnerType owner_type = 1;
    string owner_id = 2;
    AccountType account_type = 3;
    google.protobuf.Timestamp from = 4;
    google.protobuf.Timestamp to = 5;
}

message GetOwnerStatementResponse {
    repeated AccountStatement statements = 1;
}

message OwnerSummary {
    OwnerType owner_type = 1;
    string owner_id = 2;
    AccountType account_type = 3;
    repeated AccountBalance account_balances = 4;
    double total_balance_usd_equivalent = 5;
}

message AccountBalance {
    int64 account_id = 1;
    string account_number = 2;
    string currency = 3;
    double balance = 4;
    double available_balance = 5;
}

message GetOwnerSummaryRequest {
    OwnerType owner_type = 1;
    string owner_id = 2;
    AccountType account_type = 3;
}

message GetOwnerSummaryResponse {
    OwnerSummary summary = 1;
}

// ===============================
// REPORT MESSAGES
// ===============================

message DailyReport {
    OwnerType owner_type = 1;
    string owner_id = 2;
    int64 account_id = 3;
    string currency = 4;
    double total_debit = 5;
    double total_credit = 6;
    double balance = 7;
    double net_change = 8;
    google.protobuf.Timestamp date = 9;
}

message GenerateDailyReportRequest {
    google.protobuf.Timestamp date = 1;
    AccountType account_type = 2;
}

message GenerateDailyReportResponse {
    repeated DailyReport reports = 1;
}

message TransactionSummary {
    TransactionType transaction_type = 1;
    string currency = 2;
    int64 count = 3;
    double total_amount = 4;
    double min_amount = 5;
    double max_amount = 6;
    double avg_amount = 7;
}

message GetTransactionSummaryRequest {
    AccountType account_type = 1;
    google.protobuf.Timestamp from = 2;
    google.protobuf.Timestamp to = 3;
}

message GetTransactionSummaryResponse {
    repeated TransactionSummary summaries = 1;
}

message GetSystemHoldingsRequest {
    AccountType account_type = 1;
}

message GetSystemHoldingsResponse {
    map<string, double> holdings = 1; // currency -> amount
}

// ===============================
// FEE MESSAGES
// ===============================

message TransactionFee {
    int64 id = 1;
    string receipt_code = 2;
    int64 fee_rule_id = 3;
    FeeType fee_type = 4;
    double amount = 5;
    string currency = 6;
    optional int64 collected_by_account_id = 7;
    optional int64 ledger_id = 8;
    optional string agent_external_id = 9;
    optional string commission_rate = 10;
    google.protobuf.Timestamp created_at = 11;
}

message CalculateFeeRequest {
    TransactionType transaction_type = 1;
    double amount = 2;
    optional string source_currency = 3;
    optional string target_currency = 4;
    optional AccountType account_type = 5;
    optional OwnerType owner_type = 6;
}

message FeeCalculation {
    FeeType fee_type = 1;
    double amount = 2;
    string currency = 3;
    optional string applied_rate = 4;
    optional int64 rule_id = 5;
    string calculated_from = 6;
}

message CalculateFeeResponse {
    FeeCalculation calculation = 1;
}

message GetFeesByReceiptRequest {
    string receipt_code = 1;
}

message GetFeesByReceiptResponse {
    repeated TransactionFee fees = 1;
}

message GetAgentCommissionSummaryRequest {
    string agent_external_id = 1;
    google.protobuf.Timestamp from = 2;
    google.protobuf.Timestamp to = 3;
}

message GetAgentCommissionSummaryResponse {
    map<string, double> commissions = 1; // currency -> total commission
}

// ===============================
// HEALTH CHECK
// ===============================

message HealthCheckRequest {}

message HealthCheckResponse {
    string status = 1; // "healthy", "degraded", "unhealthy"
    map<string, string> components = 2; // component -> status
    int64 timestamp = 3;
}

// ===============================
// BATCH OPERATIONS
// ===============================

message BatchExecuteTransactionsRequest {
    repeated ExecuteTransactionRequest transactions = 1;
    bool fail_on_first_error = 2;
}

message BatchExecuteTransactionsResponse {
    repeated ExecuteTransactionResponse results = 1;
    map<int32, string> errors = 2; // index -> error message
}

message BatchGetBalancesRequest {
    repeated string account_numbers = 1;
}

message BatchGetBalancesResponse {
    repeated Balance balances = 1;
    map<int32, string> errors = 2;
}

// ===============================
// STREAMING MESSAGES
// ===============================

message StreamTransactionEventsRequest {
    optional OwnerType owner_type = 1;
    optional string owner_id = 2;
    optional AccountType account_type = 3;
}

message TransactionEvent {
    string event_type = 1; // "transaction.completed", "transaction.failed"
    string receipt_code = 2;
    int64 transaction_id = 3;
    TransactionStatus status = 4;
    double amount = 5;
    string currency = 6;
    optional string error_message = 7;
    google.protobuf.Timestamp timestamp = 8;
}

// NEW 
// ===============================
// NEW TRANSACTION OPERATION MESSAGES
// ===============================

message CreditRequest {
    string account_number = 1;
    double amount = 2;
    string currency = 3;
    AccountType account_type = 4;
    string description = 5;
    optional string idempotency_key = 6;
    optional string external_ref = 7;
    string created_by_external_id = 8;
    OwnerType created_by_type = 9;
}

message CreditResponse {
    int64 journal_id = 1;
    string receipt_code = 2;
    double balance_after = 3;
    google.protobuf.Timestamp created_at = 4;
}

message DebitRequest {
    string account_number = 1;
    double amount = 2;
    string currency = 3;
    AccountType account_type = 4;
    string description = 5;
    optional string idempotency_key = 6;
    optional string external_ref = 7;
    string created_by_external_id = 8;
    OwnerType created_by_type = 9;
}

message DebitResponse {
    int64 journal_id = 1;
    string receipt_code = 2;
    double balance_after = 3;
    google.protobuf.Timestamp created_at = 4;
}

message TransferRequest {
    string from_account_number = 1;
    string to_account_number = 2;
    double amount = 3;
    AccountType account_type = 4;
    string description = 5;
    optional string idempotency_key = 6;
    optional string external_ref = 7;
    string created_by_external_id = 8;
    OwnerType created_by_type = 9;
    optional string agent_external_id = 10; // Agent who facilitated
}

message TransferResponse {
    int64 journal_id = 1;
    string receipt_code = 2;
    double fee_amount = 3;
    double agent_commission = 4;
    google.protobuf.Timestamp created_at = 5;
}

message ConversionRequest {
    string from_account_number = 1;
    string to_account_number = 2;
    double amount = 3; // Amount in source currency
    AccountType account_type = 4;
    optional string idempotency_key = 5;
    optional string external_ref = 6;
    string created_by_external_id = 7;
    OwnerType created_by_type = 8;
    optional string agent_external_id = 9;
}

message ConversionResponse {
    int64 journal_id = 1;
    string receipt_code = 2;
    string source_currency = 3;
    string dest_currency = 4;
    double source_amount = 5;
    double converted_amount = 6;
    string fx_rate = 7;
    int64 fx_rate_id = 8;
    double fee_amount = 9;
    google.protobuf.Timestamp created_at = 10;
}

message TradeRequest {
    string account_number = 1;
    double amount = 2;
    string currency = 3;
    AccountType account_type = 4;
    string trade_id = 5;
    string trade_type = 6; // e.g., "forex", "crypto", "sports"
    optional string idempotency_key = 7;
    string created_by_external_id = 8;
    OwnerType created_by_type = 9;
}

message TradeResponse {
    int64 journal_id = 1;
    string receipt_code = 2;
    string trade_id = 3;
    string trade_result = 4; // "win" or "loss"
    double balance_after = 5;
    google.protobuf.Timestamp created_at = 6;
}

message AgentCommissionRequest {
    string agent_external_id = 1;
    string transaction_ref = 2; // Receipt code of original transaction
    string currency = 3;
    double transaction_amount = 4;
    double commission_amount = 5;
    optional string commission_rate = 6;
    optional string idempotency_key = 7;
}

message AgentCommissionResponse {
    int64 journal_id = 1;
    string receipt_code = 2;
    string agent_external_id = 3;
    double commission_amount = 4;
    google.protobuf.Timestamp created_at = 5;
}


enum ApprovalStatus {
    APPROVAL_STATUS_UNSPECIFIED = 0;
    APPROVAL_STATUS_PENDING = 1;
    APPROVAL_STATUS_APPROVED = 2;
    APPROVAL_STATUS_REJECTED = 3;
    APPROVAL_STATUS_EXECUTED = 4;
    APPROVAL_STATUS_FAILED = 5;
}

message TransactionApproval {
    int64 id = 1;
    int64 requested_by = 2;
    TransactionType transaction_type = 3;
    string account_number = 4;
    double amount = 5;
    string currency = 6;
    string description = 7;
    ApprovalStatus status = 8;
    optional int64 approved_by = 9;
    optional string rejection_reason = 10;
    optional string receipt_code = 11;
    optional string to_account_number = 12; // For transfers
    google.protobuf.Timestamp created_at = 13;
    google.protobuf.Timestamp updated_at = 14;
}

message CreateTransactionApprovalRequest {
    int64 requested_by = 1;
    TransactionType transaction_type = 2;
    string account_number = 3;
    double amount = 4;
    string currency = 5;
    string description = 6;
    optional string to_account_number = 7; // For transfers
}

message CreateTransactionApprovalResponse {
    TransactionApproval approval = 1;
    string message = 2;
}

message GetPendingApprovalsRequest {
    optional int32 limit = 1;
    optional int32 offset = 2;
}

message GetPendingApprovalsResponse {
    repeated TransactionApproval approvals = 1;
    int32 total = 2;
}

message ApproveTransactionRequest {
    int64 request_id = 1;
    int64 approved_by = 2;
    bool approved = 3;
    optional string reason = 4;
}

message ApproveTransactionResponse {
    TransactionApproval approval = 1;
    optional string receipt_code = 2;
    string message = 3;
}

message GetApprovalHistoryRequest {
    optional int64 requested_by = 1;
    optional ApprovalStatus status = 2;
    optional google.protobuf.Timestamp from = 3;
    optional google. protobuf.Timestamp to = 4;
    int32 limit = 5;
    int32 offset = 6;
}

message GetApprovalHistoryResponse {
    repeated TransactionApproval approvals = 1;
    int32 total = 2;
}


// ===============================
// AGENT MESSAGES
// ===============================

enum RelationshipType {
    RELATIONSHIP_TYPE_UNSPECIFIED = 0;
    RELATIONSHIP_TYPE_DIRECT = 1;
    RELATIONSHIP_TYPE_REFERRAL = 2;
    RELATIONSHIP_TYPE_PARTNER = 3;
    RELATIONSHIP_TYPE_FRANCHISE = 4;
}

message Agent {
    string agent_external_id = 1;
    optional string user_external_id = 2; // Auth user ID
    optional string service = 3;
    optional string commission_rate = 4; // NUMERIC as string (e.g., "0.05" for 5%)
    RelationshipType relationship_type = 5;
    bool is_active = 6;
    optional string name = 7;
    map<string, string> metadata = 8;
    google.protobuf. Timestamp created_at = 9;
    google.protobuf.Timestamp updated_at = 10;
    repeated Account accounts = 11; // ✅ Agent's accounts (commission account, etc.)
}

message AgentCommission {
    int64 id = 1;
    string agent_external_id = 2;
    string user_external_id = 3;
    int64 agent_account_id = 4;
    int64 user_account_id = 5;
    string receipt_code = 6;
    string transaction_amount = 7; // NUMERIC as string
    string commission_rate = 8; // NUMERIC as string
    string commission_amount = 9; // NUMERIC as string
    string currency = 10;
    bool paid_out = 11;
    optional string payout_receipt_code = 12;
    optional google.protobuf.Timestamp paid_out_at = 13;
    google. protobuf.Timestamp created_at = 14;
}

message CreateAgentRequest {
    optional string user_external_id = 1;
    optional string service = 2;
    optional string commission_rate = 3; // "0.05" for 5%
    RelationshipType relationship_type = 4;
    bool is_active = 5;
    optional string name = 6;
    map<string, string> metadata = 7;
    bool create_accounts = 8; // ✅ Whether to auto-create commission accounts
}

message CreateAgentResponse {
    Agent agent = 1;
    string message = 2;
}

message UpdateAgentRequest {
    string agent_external_id = 1;
    optional string user_external_id = 2;
    optional string service = 3;
    optional string commission_rate = 4;
    optional RelationshipType relationship_type = 5;
    optional bool is_active = 6;
    optional string name = 7;
    map<string, string> metadata = 8;
}

message UpdateAgentResponse {
    Agent agent = 1;
    string message = 2;
}

message DeleteAgentRequest {
    string agent_external_id = 1;
}

message DeleteAgentResponse {
    string message = 1;
}

message GetAgentByIDRequest {
    string agent_external_id = 1;
    bool include_accounts = 2; // ✅ Whether to include agent accounts in response
}

message GetAgentByIDResponse {
    Agent agent = 1;
}

message GetAgentByUserIDRequest {
    string user_external_id = 1;
    bool include_accounts = 2; // ✅ Whether to include agent accounts in response
}

message GetAgentByUserIDResponse {
    Agent agent = 1;
}

message ListAgentsRequest {
    int32 limit = 1; // Max 100
    int32 offset = 2;
    bool include_accounts = 3; // ✅ Whether to include accounts for each agent
}

message ListAgentsResponse {
    repeated Agent agents = 1;
    int32 total = 2;
}

message ListCommissionsForAgentRequest {
    string agent_external_id = 1;
    int32 limit = 2; // Max 100
    int32 offset = 3;
}

message ListCommissionsForAgentResponse {
    repeated AgentCommission commissions = 1;
    int32 total = 2;
}
// ===============================
// SERVICE DEFINITION
// ===============================

service AccountingService {
    // ===============================
    // ACCOUNT MANAGEMENT
    // ===============================
    
    // Create single account
    rpc CreateAccount(CreateAccountRequest) returns (CreateAccountResponse);
    
    // Create multiple accounts (batch)
    rpc CreateAccounts(CreateAccountsRequest) returns (CreateAccountsResponse);
    
    // Get account by ID or account number
    rpc GetAccount(GetAccountRequest) returns (GetAccountResponse);
    
    // Get all accounts for an owner
    rpc GetAccountsByOwner(GetAccountsByOwnerRequest) returns (GetAccountsByOwnerResponse);
    
    // Get or create user accounts (lazy initialization)
    rpc GetOrCreateUserAccounts(GetOrCreateUserAccountsRequest) returns (GetOrCreateUserAccountsResponse);
    
    // Update account settings
    rpc UpdateAccount(UpdateAccountRequest) returns (UpdateAccountResponse);
    
    // Get account balance
    rpc GetBalance(GetBalanceRequest) returns (GetBalanceResponse);
    
    // Batch get balances (optimized)
    rpc BatchGetBalances(BatchGetBalancesRequest) returns (BatchGetBalancesResponse);
    
    // ===============================
    // TRANSACTION EXECUTION
    // ===============================
    
    // Execute transaction asynchronously (returns immediately)
    rpc ExecuteTransaction(ExecuteTransactionRequest) returns (ExecuteTransactionResponse);
    
    // Execute transaction synchronously (waits for completion)
    rpc ExecuteTransactionSync(ExecuteTransactionSyncRequest) returns (ExecuteTransactionSyncResponse);
    
    // Batch execute transactions (high throughput)
    rpc BatchExecuteTransactions(BatchExecuteTransactionsRequest) returns (BatchExecuteTransactionsResponse);
    
    // Get transaction status
    rpc GetTransactionStatus(GetTransactionStatusRequest) returns (GetTransactionStatusResponse);
    
    // Get full transaction details by receipt
    rpc GetTransactionByReceipt(GetTransactionByReceiptRequest) returns (GetTransactionByReceiptResponse);
    
    // ===============================
    // JOURNAL & LEDGER QUERIES
    // ===============================
    
    // Get journal by ID
    rpc GetJournal(GetJournalRequest) returns (GetJournalResponse);
    
    // List journals with filters
    rpc ListJournals(ListJournalsRequest) returns (ListJournalsResponse);
    
    // List ledgers for a journal
    rpc ListLedgersByJournal(ListLedgersByJournalRequest) returns (ListLedgersByJournalResponse);
    
    // List ledgers for an account
    rpc ListLedgersByAccount(ListLedgersByAccountRequest) returns (ListLedgersByAccountResponse);
    
    // ===============================
    // STATEMENTS & REPORTING
    // ===============================
    
    // Get account statement for period
    rpc GetAccountStatement(GetAccountStatementRequest) returns (GetAccountStatementResponse);
    
    // Get all statements for an owner
    rpc GetOwnerStatement(GetOwnerStatementRequest) returns (GetOwnerStatementResponse);
    
    // Get owner summary (consolidated balance)
    rpc GetOwnerSummary(GetOwnerSummaryRequest) returns (GetOwnerSummaryResponse);
    
    // Generate daily report
    rpc GenerateDailyReport(GenerateDailyReportRequest) returns (GenerateDailyReportResponse);
    
    // Get transaction summary (statistics)
    rpc GetTransactionSummary(GetTransactionSummaryRequest) returns (GetTransactionSummaryResponse);
    
    // Get system holdings by currency
    rpc GetSystemHoldings(GetSystemHoldingsRequest) returns (GetSystemHoldingsResponse);
    
    // ===============================
    // FEE MANAGEMENT
    // ===============================
    
    // Calculate fee for a transaction (preview)
    rpc CalculateFee(CalculateFeeRequest) returns (CalculateFeeResponse);
    
    // Get fees by receipt
    rpc GetFeesByReceipt(GetFeesByReceiptRequest) returns (GetFeesByReceiptResponse);
    
    // Get agent commission summary
    rpc GetAgentCommissionSummary(GetAgentCommissionSummaryRequest) returns (GetAgentCommissionSummaryResponse);
    
    // ===============================
    // STREAMING (Real-time)
    // ===============================
    
    // Stream transaction events (for real-time updates)
    rpc StreamTransactionEvents(StreamTransactionEventsRequest) returns (stream TransactionEvent);

    // ===============================
    // SIMPLE TRANSACTION OPERATIONS
    // ===============================
    
    // Credit account (system → user, NO FEES)
    rpc Credit(CreditRequest) returns (CreditResponse);
    
    // Debit account (user → system, NO FEES)
    rpc Debit(DebitRequest) returns (DebitResponse);
    
    // Transfer between accounts (P2P, FEES APPLY)
    rpc Transfer(TransferRequest) returns (TransferResponse);
    
    // Currency conversion transfer (FEES APPLY)
    rpc ConvertAndTransfer(ConversionRequest) returns (ConversionResponse);
    
    // Process trade win (NO FEES)
    rpc ProcessTradeWin(TradeRequest) returns (TradeResponse);
    
    // Process trade loss (NO FEES)
    rpc ProcessTradeLoss(TradeRequest) returns (TradeResponse);
    
    // Process agent commission (NO FEES)
    rpc ProcessAgentCommission(AgentCommissionRequest) returns (AgentCommissionResponse);
    
    // ===============================
    // HEALTH & MONITORING
    // ===============================

    // Create transaction approval request (for regular admins)
    rpc CreateTransactionApproval(CreateTransactionApprovalRequest) returns (CreateTransactionApprovalResponse);
    
    // Get pending approvals (for super admins)
    rpc GetPendingApprovals(GetPendingApprovalsRequest) returns (GetPendingApprovalsResponse);
    
    // Approve or reject transaction (for super admins)
    rpc ApproveTransaction(ApproveTransactionRequest) returns (ApproveTransactionResponse);
    
    // Get approval history
    rpc GetApprovalHistory(GetApprovalHistoryRequest) returns (GetApprovalHistoryResponse);
    
    // Health check
    rpc HealthCheck(HealthCheckRequest) returns (HealthCheckResponse);

     // ===============================
    // AGENT MANAGEMENT
    // ===============================
    
    // Create a new agent
    rpc CreateAgent(CreateAgentRequest) returns (CreateAgentResponse);
    
    // Update agent information
    rpc UpdateAgent(UpdateAgentRequest) returns (UpdateAgentResponse);
    
    // Delete agent (soft delete recommended)
    rpc DeleteAgent(DeleteAgentRequest) returns (DeleteAgentResponse);
    
    // Get agent by agent external ID
    rpc GetAgentByID(GetAgentByIDRequest) returns (GetAgentByIDResponse);
    
    // Get agent by user external ID
    rpc GetAgentByUserID(GetAgentByUserIDRequest) returns (GetAgentByUserIDResponse);
    
    // List all agents with pagination
    rpc ListAgents(ListAgentsRequest) returns (ListAgentsResponse);
    
    // ===============================
    // AGENT COMMISSION QUERIES
    // ===============================
    
    // List commissions for a specific agent
    rpc ListCommissionsForAgent(ListCommissionsForAgentRequest) returns (ListCommissionsForAgentResponse);

}
